---
title: Computed和Watch
date: 2025-11-27 17:24:35
permalink: /vue/Computed和Watch
# titleTag: 
categories:
  - Vue
tags:
  - vue

---

[javascript - 用了这么久Vue，你真的懂Computed和Watch的区别吗？ - 个人文章 - SegmentFault 思否](https://segmentfault.com/a/1190000047242900)







## Vue computed vs watch 核心总结
## 一、核心差异与选择原则
| 特性     | computed（计算属性）               | watch（侦听器）                 |
| -------- | ---------------------------------- | ------------------------------- |
| 核心作用 | 依赖数据计算新值（缓存结果）       | 监听数据变化执行副作用/异步操作 |
| 触发时机 | 依赖变化时自动重新计算             | 监听目标变化时触发回调          |
| 缓存机制 | 有（依赖不变时复用结果）           | 无（变化即触发）                |
| 适用场景 | 同步计算、多依赖推导、简化模板逻辑 | 异步操作、副作用执行、路由监听  |
| 代码风格 | 声明式（简洁）                     | 命令式（灵活）                  |

### 选择原则
> 能用 computed 优先用 computed，需要异步/副作用时用 watch

## 二、各自最佳使用场景
### computed 适用场景
1. **简化模板复杂表达式**  
   替代模板中嵌套的逻辑运算（如字符串处理、条件判断），提升可读性
2. **多依赖数据计算**  
   基于多个响应式数据推导新值（如购物车总价、筛选后的列表）

### watch 适用场景
1. **数据变化触发异步操作**  
   如搜索关键词变化后延迟请求接口、数据更新后同步到本地存储
2. **执行副作用**  
   如数据变化时修改DOM、发送埋点事件
3. **监听非响应式数据**  
   如路由变化（$route）、第三方库状态变化

## 三、关键用法与避坑指南
### computed 关键要点
- 不可修改：computed 是只读属性，直接赋值会报错
- 依赖追踪：自动追踪函数内使用的响应式数据，依赖不变则不重新计算

### watch 关键用法
| 功能需求             | 实现方式                                             |
| -------------------- | ---------------------------------------------------- |
| 深度监听对象内部属性 | 配置 `deep: true`（注意：大对象慎用，影响性能）      |
| 组件初始化时立即执行 | 配置 `immediate: true`                               |
| 监听多个数据         | Vue3：数组形式 `watch([a, b], ([newA, newB]) => {})` |
| 自动追踪依赖（Vue3） | 使用 `watchEffect`（无需指定监听目标，自动收集依赖） |

### 常见坑与解决方案
1. **watch 监听不到对象内部变化** → 开启 `deep: true`
2. **watch 初始化不执行** → 配置 `immediate: true`
3. **异步操作竞态问题** → 取消前一次请求（如清除定时器、abort请求）
4. **无限循环** → 避免在 watch 回调中修改监听的自身数据（需加条件判断）
5. **Vue3 组合式API用法**  
   - watch：需明确指定监听目标，支持新旧值对比
   - watchEffect：自动追踪依赖，无新旧值对比，初始化立即执行

## 四、Vue3 新增特性
| API         | 特点                                           | 适用场景                             |
| ----------- | ---------------------------------------------- | ------------------------------------ |
| watch       | 需明确监听目标，支持新旧值对比、deep/immediate | 需要精确控制监听目标、需要旧值的场景 |
| watchEffect | 自动收集依赖，初始化立即执行，无旧值           | 无需旧值、依赖动态变化的场景         |




