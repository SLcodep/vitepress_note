---
title: 京山桥米项目
date: 2025-12-25 00:58:41
permalink: /qianduan/京山桥米项目
categories:
  - 前端
tags:
  - 项目
---

## 简历摘要
项目内容：京山桥米项目是与京山政府合作的智慧农业项目，用于展示京山市不同乡镇的空气温湿度、光照、降雨量等数据以及展示不同场地的实时监控等信息。
关键技术：Vue3+Element Plus+websocket+three.js
项目亮点：1.使用websocket减少频繁发起视频请求；2.针对3D可视化控制灌溉three.js 3D模型加载卡顿问题，采用组件懒加载、通过requestIdleCallback利用浏览器事件循环空闲时加载模型非首屏3D资源，配合webpack打包优化，首屏加载速度提升。3.针对大屏背景图加载慢，通过cdn实现加速。4.echarts


## 关键内容
### 1.three.js在项目中是如何使用的？

### 2.项目中为什么使用websocket？
> 可能附加问题：为什么不使用SSE而使用websocket？
::: details 💡农业环境检测系统数据采集与页面渲染全流程
农业环境检测系统实现温度、湿度、光照、土壤湿度等数据的采集和页面渲染，核心分为 4 层架构：感知层（传感器采集）→ 传输层（数据上传）→ 服务层（数据处理存储）→ 应用层（前端页面渲染）。
首先关注的问题是从何从温度、湿度传感器将收集的数据上传到服务器？
**1.感知层**：核心是传感器 + 主控板的硬件组合，负责将物理环境的模拟信号转为数字信号。
**2.传输层：**
2.1 主控板将校准后的数据封装为 JSON 格式
```json
{
  "deviceId": "sensor_001",
  "timestamp": 1735689600,
  "data": {
    "temperature": 25.5,
    "humidity": 65.2,
    "light": 800,
    "soilHumidity": 45.0
  }
}
```
2.2 主控板通过传输协议（HTTP/HTTPS POST、MQTT）将数据发送到服务器。
**MQTT协议**：更适合物联网场景，低带宽、低功耗，支持设备与服务器的双向通信（服务器可下发指令控制硬件）。
**HTTP POST**：适合小型系统，开发简单，直接调用服务器接口上传。
 
3.服务层:服务器端负责接收硬件上传的数据，进行存储和处理，并向前端提供数据查询接口。
:::

**传统轮询方案：**
- 每秒发送8个HTTP请求 = 8次网络握手
- 数据延迟：1-5秒
- 服务器压力：连接频繁创建/销毁
- 带宽浪费：大量重复的HTTP头部

**WebSocket方案：**
- 单次连接 = 持续双向通信
- 数据延迟：<100ms
- 服务器压力：连接复用
- 带宽优化：仅传输有效数据

### 3.cdn实现加速？
> 1.创建OSS Bucket
> 2.上传图片
> 3.绑定CDN域名
> 4.域名解析

::: details 💡背景图加载慢问题
打开devtools-network中能看到对背景图片的请求时间非常长，而DOM在之前已经加载成功，但是因为图片一直未加载成功导致页面白屏很久。而通过使用CDN后，图片请求时间大致为1s内，大大缩短首屏加载速度。
![京山桥米](/public/qian/京山桥米.png)
:::

将资源上传到CDN，绑定域名。
以 **阿里云 OSS + CDN** 为例：

参考内容-[如何添加加速域名和绑定CNAME](https://developer.aliyun.com/article/98194)

**1.创建 OSS Bucket**
登录阿里云 → 打开 OSS → 创建 Bucket（公共读权限）。
**2.上传图片**
用控制台或 ossutil 工具上传背景图。
**3.绑定 CDN 域名**
打开 CDN 控制台 → 添加域名 → 源站类型选择 OSS。
配置加速区域（国内/全球）。
**4.域名解析**
在域名服务商（如阿里云 DNS）将 CDN 域名解析到 CDN 提供的 CNAME。

**项目中如何使用**
假设你的 CDN 域名为 https://cdn.example.com，图片路径为 /bg/big-bg.jpg
```js
body {
  background-image: url('https://cdn.example.com/bg/big-bg.jpg');
  background-size: cover;
}
```
### 4.组件懒加载？
在Vue3中，组件懒加载可以通过`defineAsyncComponent`函数实现。这个函数允许开发者定义一个异步组件，该组件在需要时才从服务器加载。
```js
import { defineAsyncComponent } from 'vue';

const AsyncComponent = defineAsyncComponent(() =>
  import('./components/AsyncComponent.vue')
);
```
在定义异步组件时，可以指定一些加载策略，如`suspense`、`lazy`、`error`等，以满足不同的加载需求。
```js
const LazyComponent = defineAsyncComponent({
  loader: () => import('./components/LazyComponent.vue'),
  loadingComponent: LoadingComponent, // 加载中显示的组件
  errorComponent: ErrorComponent, // 加载失败显示的组件
  delay: 200, // 延迟显示加载中组件的时间
  timeout: 3000 // 最长加载时间，超过这个时间则显示错误组件
});
```
## 
